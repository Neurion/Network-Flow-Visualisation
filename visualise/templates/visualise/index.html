{% load staticfiles %}

<link rel="stylesheet" type="text/css" href="{% static 'visualise/css/main.css' %}" />
<script type="text/javascript" src="{% static 'visualise/javascript/jquery-2.1.3.min.js' %}" ></script>
<script language="javascript" type="text/javascript" src="{% static 'visualise/javascript/flot/jquery.flot.js' %}"></script>
<script language="javascript" type="text/javascript" src="{% static 'visualise/javascript/flot/jquery.flot.time.js' %}"></script>
<script language="javascript" type="text/javascript" src="{% static 'visualise/javascript/flot/jquery.flot.axislabels.js' %}"></script>
<script language="javascript" type="text/javascript" src="{% static 'visualise/javascript/flot/jquery.flot.pie.js' %}"></script>
<script type="text/javascript" src="{% static 'visualise/javascript/main.js' %}" ></script>

<script>



var timeOldest = "{{ time_oldest }}"*1000;
var timeNewest = "{{ time_newest }}"*1000;
//console.log("\n\n\nTimeline");
//console.log("Time oldest:"+timeOldest);
//console.log("Time newest:"+timeNewest);
//console.log(Math.round(timeOldest));
var date = new Date(Math.round(timeOldest));
//console.log(date.toString());
//console.log(Math.round(timeNewest));
date = new Date(Math.round(timeNewest));
//console.log(date.toString());

var tcpCount = "{{ tcp_count }}";
var udpCount = "{{ udp_count }}";
//console.log("\n\n\nProtocols");
//console.log("TCP packets:"+tcpCount);
//console.log("UDP packets:"+udpCount);

var bytesDownloaded = "{{ bytes_downloaded }}";
var bytesUploaded = "{{ bytes_uploaded }}";
console.log(bytesDownloaded);
console.log(bytesUploaded);
//console.log("\n\n\nUsage:");
//console.log("downloaded:"+bytesDownloaded);
//console.log("uploaded:"+bytesUploaded);
</script>


<div id="container">    

    <div id="title">
        <h1>Network Flow Visualisation</h1>
    </div> <!-- Close title -->

    <div id="left">
        <div id="filter_container">        
            <h2>Filter</h2>
            <hr>
            <form action="/" method="POST">

                {% csrf_token %}

                <span class="bold">Device:(to do)</span><br>
                <select id="select_mac" ></select>            
                <br><br>
                <span class="bold">Time period:(to do)</span><br>
                <!--{{ filter_form }}-->
                {% if f_interval %}

                    <script>
                        f_interval = "{{ f_interval }}";
                    </script>
                    
                    {% if f_interval == "daily" %}
                        <input type="radio" name="time_interval" value="daily" checked="true">Daily</input>
                    {% else %}
                        <input type="radio" name="time_interval" value="daily">Daily</input>     
                    {% endif %}


                    {% if f_interval == "weekly" %}
                        <input type="radio" name="time_interval" value="weekly" checked="true">Weekly</input>
                    {% else %}
                        <input type="radio" name="time_interval" value="weekly">Weekly</input>     
                    {% endif %}
                    

                    {% if f_interval == "monthly" %}
                        <input type="radio" name="time_interval" value="monthly" checked="true">Monthly</input>
                    {% else %}
                        <input type="radio" name="time_interval" value="monthly">Monthly</input>     
                    {% endif %}

                {% else %}

                    <input type="radio" name="time_interval" value="daily" checked="true">Daily</input>
                    <input type="radio" name="time_interval" value="weekly">Weekly</input>
                    <input type="radio" name="time_interval" value="monthly">Monthly</input>

                {% endif %}
                <!-- Direction -->
                <br><br>
                <span class="bold">Direction:(to do)</span><br>
                Ingress:
                <input id="check_ingress" name="check_ingress" type="checkbox" checked="true">  
                Egress:
                <input id="check_egress" name="check_egress" type="checkbox" checked="true">          
                <!-- Ports -->
                <br><br>
                <span class="bold">Port:</span>
                <input id="text_port" name="text_port" type="text" placeholder="0-65535" value="{{ f_source_port }}">
                <br><br>
                <input id="btn_submit" name="btn_submit" type="submit" value="Apply">
            </form>  
        </div><!-- Close filter_container -->

    </div><!-- Close left -->

    <div id="middle">

        <div id="timeline">
            <div id="timeline_container_chart"></div>
        </div><!-- Close timeline --> 

        <div id="flows_table">
            <!-- Table header -->
            <div class="row">
                <div class="cell">Device MAC</div>
                <div class="cell">Application</div>
                <div class="cell">Downloaded</div>
                <div class="cell">Uploaded</div>
            </div>
            <!-- Data -->
        </div><!-- Close flows_table -->  

    </div><!-- Close middle -->  

    <div id="right">

        <div id="usage">
            <div class="header">Usage</div>             
            <div id="usage_container_chart"></div>
        </div>

        <div id="protocols">
            <div class="header">Common Protocols</div>                  
            <div id="protocol_container_chart"></div>
        </div>

        <div class="geolocation">
            <div class="header">Geolocation(to do)</div>
            Top 10 countries
            <ol>
                <li>New Zealand</li>
                <li>China</li>
                <li>UK</li>
                <li>USA</li>
            </ol>  
        </div><!-- Close geolocation -->

    </div><!-- Close right -->












    <br>

    <div id="junk">

        {% if f_source_port %}
            <script>
                console.log("{{ f_source_port }}");
            </script>        
        {% endif %}

        {% if macs_bytes %}
            <script>
                console.log("{{ macs_bytes }}");
            </script>        
            {% for mac in macs_bytes %} 
                <script>
                    //console.log("{{ mac }}");
                    sourceMACBytes.push("{{ mac }}");
                </script>
            {% endfor %}
        {% endif %}


        {% if source_macs %}
            <script>
                //console.log("{{ source_macs }}");
            </script>
            {% for a in source_macs %}            
                <script>
                    // Populate MAC address select box
                    sourceMACAddresses.push("{{ a }}");
                </script>                
            {% endfor %}
        {% endif %}
        
            {% if packets_list %}
                {% for packet in packets_list %}

                    <script>
                        //console.log({{ packet.timestamp }});
                        var t = [Math.floor({{ packet.timestamp }}), {{ packet.bytes_size }}];
                        //console.log(t);
                        timelineData.push(t);
                    </script>

                    <!--
                    <ul>                 
                    <li>{{ packet.timestamp }}</li>
                    <li>{{ packet.bytes_size }}</li>
                    <li>{{ packet.mac_src }}</li>
                    <li>{{ packet.mac_dst }}</li>
                    <li>{{ packet.ip_src}}:{{ packet.source_port }}</li>        
                    <li>{{ packet.ip_dst }}:{{ packet.destination_port }}</li>
                    <li>{{ packet.protocol }}</li>
                    </ul>
                    -->

                    <script>
                        var p1 = {{ packet.protocol }};
                        protocols_distribution.push(p1);
                    </script>

                {% endfor %}
            {% else %}
                <p>No packets are available.</p>
            {% endif %}
            
    </div>
    
    <!--
        {% if protocols_list %}
        {% for protocol in protocols_list %}
            <li><a href="{% url 'visualise:detail' protocol.id %}">{{ protocol.protocol_type }}</a></li>  
            <script>
            var p1 = {{ protocol.protocol_type }};
            </script>
        {% endfor %}
        {% else %}
            <p>No protocols are available.</p>
        {% endif %}
    -->

</div><!-- Close container -->




<!--
    Things to do:
        IP address location
        Use Libprotoident for application inspection?
-->